steps:
- id: 'install'
  name: 'gcr.io/cloud-builders/npm'
  args: ['install']

- id: 'type-check'
  name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'typecheck']

- id: 'test'
  name: 'gcr.io/cloud-builders/npm'
  env: ['CI=true']
  args: ['run', 'test']

  # The build and deploy steps for each region must happen in direct sequence
  # or the wrong build might get deployed to the wrong place
  # 1. Build for region A
  # 2. Deploy to region A
  # 3. Build for region B
  # 4. Deploy to region B
- id: 'build-norway'
  name: 'gcr.io/cloud-builders/npm'
  env: ['CI=true', 'REACT_APP_API_URL=https://data.gieffektivt.no']
  args: ['run', 'build']

- id: 'deploy-norway'
  name: 'gcr.io/cloud-builders/gsutil'
  args: ['-m', 'cp', '-r', 'build/*', 'gs://static.gieffektivt.no/']

  # TODO: Swap to prod api url and bucket when available
- id: 'build-sweden'
  name: 'gcr.io/cloud-builders/npm'
  env: ['CI=true', 'REACT_APP_API_URL=https://api.dev.geeffektivt.se']
  args: ['run', 'build']

- id: 'deploy-sweden'
  name: 'gcr.io/cloud-builders/gsutil'
  args: ['-m', 'cp', '-r', 'build/*', 'gs://admin.dev.geeffektivt.se/']