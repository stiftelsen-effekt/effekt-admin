steps:
- id: 'install'
  name: 'gcr.io/cloud-builders/npm'
  args: ['install']

- id: 'type-check'
  name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'typecheck']

- id: 'test'
  name: 'gcr.io/cloud-builders/npm'
  env: ['CI=true']
  args: ['run', 'test']

- id: 'build-norway'
  name: 'gcr.io/cloud-builders/npm'
  env: ['CI=true', 'REACT_APP_API_URL=https://data.gieffektivt.no']
  args: ['run', 'build']
  waitFor: ['test']

- id: 'build-sweden'
  name: 'gcr.io/cloud-builders/npm'
  env: ['CI=true', 'REACT_APP_API_URL=https://api.dev.geeffektivt.se']
  args: ['run', 'build']
  waitFor: ['test']

- id: 'deploy-norway'
  name: 'gcr.io/cloud-builders/gsutil'
  args: ['-m', 'cp', '-r', 'build/*', 'gs://effekt-admin-dev/']
  waitFor: ['build-norway']

- id: 'deploy-sweden'
  name: 'gcr.io/cloud-builders/gsutil'
  args: ['-m', 'cp', '-r', 'build/*', 'gs://admin.dev.geeffektivt.se/']
  waitFor: ['build-sweden']